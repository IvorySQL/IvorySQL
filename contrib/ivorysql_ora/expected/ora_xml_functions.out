--
-- Test Ivorysql compatible oracle XML functions
--
create table inaf(a int, b xmltype);
insert into inaf values(1,xmltype('<a><b>100</b></a>'));
insert into inaf values(2, '');
select * from inaf;
 a |         b         
---+-------------------
 1 | <a><b>100</b></a>
 2 | 
(2 rows)

create table xmltest(id int, data XMLType);
insert into xmltest values(1, '<value>one</value>');
insert into xmltest values(2, '<value>two</value>');
select * from xmltest;
 id |        data        
----+--------------------
  1 | <value>one</value>
  2 | <value>two</value>
(2 rows)

create table xmlnstest(id int, data xmltype);
INSERT INTO xmlnstest VALUES(1, xmltype('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com"><soapenv:Body><web:BBB><typ:EEE>41</typ:EEE><typ:FFF>42</typ:FFF></web:BBB></soapenv:Body></soapenv:Envelope>'));
--
-- extrct(XML)
--
SELECT extract(XMLType('<AA><ID>1</ID></AA>'), '/AA/ID') from dual;
  extract   
------------
 <ID>1</ID>
(1 row)

SELECT extract(XMLType('<AA><ID>1</ID></AA>'), '/AA') from dual;
   extract    
--------------
 <AA>        +
   <ID>1</ID>+
 </AA>
(1 row)

SELECT extract(XMLType('<Co Attr ="Test Attr"><ID>1</ID></Co>'), '/Co') from dual;
        extract        
-----------------------
 <Co Attr="Test Attr">+
   <ID>1</ID>         +
 </Co>
(1 row)

SELECT extract(XMLType('<Co Attr ="Test Attr"><ID>1</ID></Co>'), '/Co/@ Attr') from dual;
  extract  
-----------
 Test Attr
(1 row)

SELECT extract(XMLType('<a><b>b1</b><b>b2</b></a>'),'/a/b[2]') from dual;
  extract  
-----------
 <b>b2</b>
(1 row)

SELECT extract(XMLType('<a><b>b1</b><b>b2</b></a>'),'/a/b[3]') from dual;
 extract 
---------
 
(1 row)

SELECT extract(b, '/a/b') from inaf where a = 2;
 extract 
---------
 
(1 row)

SELECT extract(XMLType('<a><b>b1</b><b>b2</b></a>'),'') from dual;
 extract 
---------
 
(1 row)

SELECT extract(XMLType('<a><b>b1</b><b>b2</b></a>'),null) from dual;
 extract 
---------
 
(1 row)

SELECT extract(data, 'soapenv:Envelope/soapenv:Body/web:BBB/typ:EEE', 'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com"') from xmlnstest where id = 1;
                       extract                        
------------------------------------------------------
 <typ:EEE xmlns:typ="http://www.def.com">41</typ:EEE>
(1 row)

--
-- extractvalue
--
SELECT extractvalue(XMLType('<a><b>100</b></a>'),'/a/b') from dual;
 extractvalue 
--------------
 100
(1 row)

SELECT extractvalue(XMLType('<a><b>100</b></a>'),'/a') from dual;
ERROR:  EXTRACTVALUE can only retrieve value of leaf node
SELECT extractvalue(b, '/a/b') from inaf where a = 2;
 extractvalue 
--------------
 
(1 row)

SELECT extractvalue(XMLType('<a><b>b</b></a>'), '') from dual;
 extractvalue 
--------------
 
(1 row)

SELECT extractvalue(XMLType('<a><b>b</b></a>'), null) from dual;
 extractvalue 
--------------
 
(1 row)

SELECT extractvalue(XMLType('<a><b>b1</b><b>b2</b></a>'),'/a/b[1]') from dual;
 extractvalue 
--------------
 b1
(1 row)

SELECT extractvalue(XMLType('<a><b>b1</b><b>b2</b></a>'),'/a/b[2]') from dual;
 extractvalue 
--------------
 b2
(1 row)

SELECT extractvalue(XMLType('<a><b>b1</b><b>b2</b></a>'),'/a/b') from dual;
ERROR:  EXTRACTVALUE returns value of only one node
SELECT extractvalue(XMLType('<a><b><c><d><e>111></e><f>222</f></d></c></b></a>'),'/a/b/c/d') from dual;
ERROR:  EXTRACTVALUE returns value of only one node
SELECT extractvalue(data, 'soapenv:Envelope/soapenv:Body/web:BBB/typ:EEE', 'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com"') from xmlnstest where id = 1;
 extractvalue 
--------------
 41
(1 row)

--
-- existsnode
--
SELECT existsnode(XMLType('<a><b>d</b></a>'), '/a') from dual;
 existsnode 
------------
          1
(1 row)

SELECT existsnode(XMLType('<a><b>d</b></a>'), '/a/b') from dual;
 existsnode 
------------
          1
(1 row)

SELECT existsnode(XMLType('<a><b>d</b></a>'), '/a/b/c') from dual;
 existsnode 
------------
          0
(1 row)

SELECT existsnode(b, '/a/b') from inaf where a = 2;
 existsnode 
------------
           
(1 row)

SELECT existsnode(XMLType('<a><b>d</b></a>'), '') from dual;
 existsnode 
------------
           
(1 row)

SELECT existsnode(XMLType('<a><b>d</b></a>'), null) from dual;
 existsnode 
------------
           
(1 row)

SELECT existsnode(data, 'soapenv:Envelope/soapenv:Body/web:BBB/typ:EEE', 'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com"') from xmlnstest where id = 1;
 existsnode 
------------
          1
(1 row)

--
-- deletexml
--
SELECT deletexml(XMLType('<test><value>oldnode</value><value>oldnode</value></test>'),
  '/test/value') from dual;
 deletexml 
-----------
 <test/>
(1 row)

SELECT deletexml(XMLType('<test><value>111</value><value>222</value></test>'),
  '/test/value[1]') from dual;
      deletexml       
----------------------
 <test>              +
   <value>222</value>+
 </test>
(1 row)

SELECT deletexml(XMLType('<test><value>111</value><value>222</value></test>'),
  '/test/value[2]') from dual;
      deletexml       
----------------------
 <test>              +
   <value>111</value>+
 </test>
(1 row)

SELECT deletexml(XMLType('<a><b></b><b></b></a>'), '//b') from dual;
 deletexml 
-----------
 <a/>
(1 row)

SELECT deletexml(XMLType('<a><b></b><b></b></a>'), '/a') from dual;
 deletexml 
-----------
 
(1 row)

SELECT deletexml(b, '/a/b') from inaf where a = 2;
 deletexml 
-----------
 
(1 row)

SELECT deletexml(XMLType('<test><value></value><value><t>11</t></value></test>'),
  '/test/value/t') from dual;
 deletexml  
------------
 <test>    +
   <value/>+
   <value/>+
 </test>
(1 row)

SELECT deletexml(XMLType('<test><value>12</value><value><t>12</t><b>12</b></value></test>'),
  '/test/value/t') from dual;
      deletexml      
---------------------
 <test>             +
   <value>12</value>+
   <value>          +
     <b>12</b>      +
   </value>         +
 </test>
(1 row)

SELECT deletexml(XMLType('<a><b></b><b></b></a>'), '') from dual;
 deletexml 
-----------
 
(1 row)

SELECT deletexml(XMLType('<a><b></b><b></b></a>'), null) from dual;
 deletexml 
-----------
 
(1 row)

SELECT deletexml(data, 'soapenv:Envelope/soapenv:Body/web:BBB/typ:EEE', 'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com"') from xmlnstest where id = 1;
                                                                 deletexml                                                                  
--------------------------------------------------------------------------------------------------------------------------------------------
 <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com">+
   <soapenv:Body>                                                                                                                          +
     <web:BBB>                                                                                                                             +
       <typ:FFF>42</typ:FFF>                                                                                                               +
     </web:BBB>                                                                                                                            +
   </soapenv:Body>                                                                                                                         +
 </soapenv:Envelope>
(1 row)

--
-- appendchildxml
--
SELECT appendchildxml(XMLType('<test><value></value><value></value></test>'),
  '/test/value', XMLTYPE('<name>newnode</name>')) from dual;
      appendchildxml      
--------------------------
 <test>                  +
   <value>               +
     <name>newnode</name>+
   </value>              +
   <value>               +
     <name>newnode</name>+
   </value>              +
 </test>
(1 row)

SELECT appendchildxml(XMLType('<test><a></a><b></b></test>'),
  '/test/a', XMLTYPE('<name>aaa</name>')) from dual;
    appendchildxml    
----------------------
 <test>              +
   <a>               +
     <name>aaa</name>+
   </a>              +
   <b/>              +
 </test>
(1 row)

SELECT appendchildxml(XMLType('<a><b></b><b></b></a>'), '/a/b', XMLtype('<name>1000</name>')) from dual;
    appendchildxml     
-----------------------
 <a>                  +
   <b>                +
     <name>1000</name>+
   </b>               +
   <b>                +
     <name>1000</name>+
   </b>               +
 </a>
(1 row)

SELECT appendchildxml(XMLType('<a><b></b></a>'), '/a', XMLtype('<name>1000</name>')) from dual;
   appendchildxml    
---------------------
 <a>                +
   <b/>             +
   <name>1000</name>+
 </a>
(1 row)

SELECT appendchildxml(b, '/a/b', XMLtype('<name>1000</name>')) from inaf where a = 2;
 appendchildxml 
----------------
 
(1 row)

SELECT appendchildxml(XMLType('<a><b>666</b></a>'), '/a/b', XMLtype('<name>1000<mm>66</mm></name>')) from dual;
              appendchildxml              
------------------------------------------
 <a>                                     +
   <b>666<name>1000<mm>66</mm></name></b>+
 </a>
(1 row)

SELECT appendchildxml(XMLType('<ers:OPS xmlns:ers="http://www.test.com/schema/ers/v3"></ers:OPS>'), '/ers:OPS', XMLType('<ers:LOG xmlns:ers="http://www.test.com/schema/ers/v3" IVY="666"></ers:LOG>'),'xmlns:ers="http://www.test.com/schema/ers/v3"') from dual;
                            appendchildxml                            
----------------------------------------------------------------------
 <ers:OPS xmlns:ers="http://www.test.com/schema/ers/v3">             +
   <ers:LOG xmlns:ers="http://www.test.com/schema/ers/v3" IVY="666"/>+
 </ers:OPS>
(1 row)

--
-- updatexml
--
SELECT updatexml(xmltype('<value>one</value>'), '/value', xmltype('<newvalue>1111</newvalue>')) FROM dual;
         updatexml         
---------------------------
 <newvalue>1111</newvalue>
(1 row)

SELECT updatexml(b, '/a/b', xmltype('<b>1111</b>')) from inaf where a = 2;
 updatexml 
-----------
 
(1 row)

SELECT updatexml(data, '/value', xmltype('<newvalue>newnode</newvalue>')) FROM xmltest;
          updatexml           
------------------------------
 <newvalue>newnode</newvalue>
 <newvalue>newnode</newvalue>
(2 rows)

SELECT updatexml(data, '/value/text()', '1000') FROM xmltest;
      updatexml      
---------------------
 <value>1000</value>
 <value>1000</value>
(2 rows)

SELECT updatexml(XMLTYPE('<a><b>b1</b><b>b2</b></a>'), '/b', '1000') FROM dual;
  updatexml  
-------------
 <a>        +
   <b>b1</b>+
   <b>b2</b>+
 </a>
(1 row)

SELECT updatexml(XMLTYPE('<a><b>b1</b><b>b2</b></a>'), '/b[1]/text()', '1000') FROM dual;
  updatexml  
-------------
 <a>        +
   <b>b1</b>+
   <b>b2</b>+
 </a>
(1 row)

SELECT updatexml(data, 'soapenv:Envelope/soapenv:Body/web:BBB/typ:EEE/text()',123, 'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com"') from xmlnstest where id = 1;
                                                                 updatexml                                                                  
--------------------------------------------------------------------------------------------------------------------------------------------
 <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com">+
   <soapenv:Body>                                                                                                                          +
     <web:BBB>                                                                                                                             +
       <typ:EEE>123</typ:EEE>                                                                                                              +
       <typ:FFF>42</typ:FFF>                                                                                                               +
     </web:BBB>                                                                                                                            +
   </soapenv:Body>                                                                                                                         +
 </soapenv:Envelope>
(1 row)

--
-- insertxmlbefore
--
SELECT insertxmlbefore(XMLType('<a>a</a>'),'/a', XMLType('<b>b</b>')) from dual;
ERROR:  invalid XPath expression
SELECT insertxmlbefore(XMLType('<a><b>b</b></a>'),'/a/b', XMLType('<c>c</c>')) from dual;
 insertxmlbefore 
-----------------
 <a>            +
   <c>c</c>     +
   <b>b</b>     +
 </a>
(1 row)

SELECT insertxmlbefore(XMLType('<a><b></b></a>'),'/a/b', XMLType('<c></c>')) from dual;
 insertxmlbefore 
-----------------
 <a>            +
   <c/>         +
   <b/>         +
 </a>
(1 row)

SELECT insertxmlbefore(XMLType('<a>222<b>100</b></a>'), '/a/b', XMLTYPE('<c>88</c>')) from dual;
        insertxmlbefore        
-------------------------------
 <a>222<c>88</c><b>100</b></a>
(1 row)

SELECT insertxmlbefore(XMLType('<a>222<b>100</b><b>200</b></a>'), '/a/b', XMLTYPE('<c>88</c>')) from dual;
                 insertxmlbefore                  
--------------------------------------------------
 <a>222<c>88</c><b>100</b><c>88</c><b>200</b></a>
(1 row)

SELECT insertxmlbefore(XMLType('<a>222<b>100</b><b>200</b></a>'), '/a/b[1]', XMLTYPE('<c>88</c>')) from dual;
             insertxmlbefore             
-----------------------------------------
 <a>222<c>88</c><b>100</b><b>200</b></a>
(1 row)

SELECT insertxmlbefore(XMLType('<a>222<b>100</b><b>200</b></a>'), '/a/b[2]', XMLTYPE('<c>88</c>')) from dual;
             insertxmlbefore             
-----------------------------------------
 <a>222<b>100</b><c>88</c><b>200</b></a>
(1 row)

SELECT insertxmlbefore(XMLType('<a>222<b>100</b><b>200</b></a>'), '/b', XMLTYPE('<c>88</c>')) from dual;
        insertxmlbefore         
--------------------------------
 <a>222<b>100</b><b>200</b></a>
(1 row)

SELECT insertxmlbefore(b,'/a/b', XMLType('<c>200</c>')) from inaf where a = 2;
 insertxmlbefore 
-----------------
 
(1 row)

SELECT insertxmlbefore(data, 'soapenv:Envelope/soapenv:Body/web:BBB/typ:EEE', XMLType('<typ:IVY xmlns:typ="http://www.def.com">Ivory</typ:IVY>'), 'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com"') from xmlnstest where id = 1;
                                                              insertxmlbefore                                                               
--------------------------------------------------------------------------------------------------------------------------------------------
 <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com">+
   <soapenv:Body>                                                                                                                          +
     <web:BBB>                                                                                                                             +
       <typ:IVY xmlns:typ="http://www.def.com">Ivory</typ:IVY>                                                                             +
       <typ:EEE>41</typ:EEE>                                                                                                               +
       <typ:FFF>42</typ:FFF>                                                                                                               +
     </web:BBB>                                                                                                                            +
   </soapenv:Body>                                                                                                                         +
 </soapenv:Envelope>
(1 row)

--
-- insertxmlafter
--
SELECT insertxmlafter(XMLType('<a><b>100</b></a>'),'/a/b',XMLType('<c>88</c>')) from dual;
 insertxmlafter 
----------------
 <a>           +
   <b>100</b>  +
   <c>88</c>   +
 </a>
(1 row)

SELECT insertxmlafter(XMLType('<a>200<b>100</b><b>300</b></a>'),'/a/b',XMLType('<c>88</c>')) from dual;
                  insertxmlafter                  
--------------------------------------------------
 <a>200<b>100</b><c>88</c><b>300</b><c>88</c></a>
(1 row)

SELECT insertxmlafter(XMLType('<a>200<b>100</b><b>300</b></a>'),'/a/b[1]',XMLType('<c>88</c>')) from dual;
             insertxmlafter              
-----------------------------------------
 <a>200<b>100</b><c>88</c><b>300</b></a>
(1 row)

SELECT insertxmlafter(XMLType('<a>200<b>100</b><b>300</b></a>'),'/a/b[2]',XMLType('<c>88</c>')) from dual;
             insertxmlafter              
-----------------------------------------
 <a>200<b>100</b><b>300</b><c>88</c></a>
(1 row)

SELECT insertxmlafter(XMLType('<a>200<b>100</b><b>300</b></a>'),'/b',XMLType('<c>88</c>')) from dual;
         insertxmlafter         
--------------------------------
 <a>200<b>100</b><b>300</b></a>
(1 row)

SELECT insertxmlafter(b,'/a/b', XMLType('<c>200</c>')) from inaf where a = 2;
 insertxmlafter 
----------------
 
(1 row)

SELECT insertxmlafter(data, 'soapenv:Envelope/soapenv:Body/web:BBB/typ:EEE', XMLType('<typ:IVY xmlns:typ="http://www.def.com">Ivory</typ:IVY>'), 'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com"') from xmlnstest where id = 1;
                                                               insertxmlafter                                                               
--------------------------------------------------------------------------------------------------------------------------------------------
 <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com">+
   <soapenv:Body>                                                                                                                          +
     <web:BBB>                                                                                                                             +
       <typ:EEE>41</typ:EEE>                                                                                                               +
       <typ:IVY xmlns:typ="http://www.def.com">Ivory</typ:IVY>                                                                             +
       <typ:FFF>42</typ:FFF>                                                                                                               +
     </web:BBB>                                                                                                                            +
   </soapenv:Body>                                                                                                                         +
 </soapenv:Envelope>
(1 row)

--
-- insertchildxml
--
SELECT insertchildxml(XMLType('<a>one<b></b>three<b></b></a>'), '//b', 'name', XMLTYPE('<name>newnode</name>')) from dual;
                            insertchildxml                             
-----------------------------------------------------------------------
 <a>one<b><name>newnode</name></b>three<b><name>newnode</name></b></a>
(1 row)

SELECT insertchildxml(XMLType('<a><b>100</b></a>'), '/a/b', 'c', XMLType('<c>88</c>')) from dual;
    insertchildxml     
-----------------------
 <a>                  +
   <b>100<c>88</c></b>+
 </a>
(1 row)

SELECT insertchildxml(XMLType('<a><b>100</b></a>'), '/a/b', 'c', XMLType('<m>88</m>')) from dual;
ERROR:  The document being inserted does not conform to specified child name
SELECT insertchildxml(b, '/a/b', 'c', XMLType('<c>200</c>')) from inaf where a = 2;
 insertchildxml 
----------------
 
(1 row)

SELECT insertchildxml(XMLType('<a><b>100</b><b>200</b></a>'), '/a/b', 'c', XMLType('<c>88</c>')) from dual;
    insertchildxml     
-----------------------
 <a>                  +
   <b>100<c>88</c></b>+
   <b>200<c>88</c></b>+
 </a>
(1 row)

SELECT insertchildxml(XMLType('<a><b>100</b><b>200</b></a>'), '/a/b[1]', 'c', XMLType('<c>88</c>')) from dual;
    insertchildxml     
-----------------------
 <a>                  +
   <b>100<c>88</c></b>+
   <b>200</b>         +
 </a>
(1 row)

SELECT insertchildxml(XMLType('<a><b>100</b><b>200</b></a>'), '/a/b[2]', 'c', XMLType('<c>88</c>')) from dual;
    insertchildxml     
-----------------------
 <a>                  +
   <b>100</b>         +
   <b>200<c>88</c></b>+
 </a>
(1 row)

SELECT insertchildxml(XMLType('<a><b>100</b><b>200</b></a>'), '/a/b[2]', '"c"', XMLType('<c>88</c>')) from dual;
ERROR:  The document being inserted does not conform to specified child name
SELECT insertchildxml(data, 'soapenv:Envelope/soapenv:Body/web:BBB/typ:EEE','typ:IVY', XMLType('<typ:IVY xmlns:typ="http://www.def.com">Ivory</typ:IVY>'), 'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com"') from xmlnstest where id = 1;
                                                               insertchildxml                                                               
--------------------------------------------------------------------------------------------------------------------------------------------
 <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com">+
   <soapenv:Body>                                                                                                                          +
     <web:BBB>                                                                                                                             +
       <typ:EEE>41<typ:IVY xmlns:typ="http://www.def.com">Ivory</typ:IVY></typ:EEE>                                                        +
       <typ:FFF>42</typ:FFF>                                                                                                               +
     </web:BBB>                                                                                                                            +
   </soapenv:Body>                                                                                                                         +
 </soapenv:Envelope>
(1 row)

--
-- insertchildxmlbefore
--
SELECT insertchildxmlbefore(XMLType('<a><b>100</b></a>'), '/a/b', 'b', XMLType('<c>88</c>')) from dual;
 insertchildxmlbefore 
----------------------
 <a>                 +
   <b>100</b>        +
 </a>
(1 row)

SELECT insertchildxmlbefore(XMLType('<a><b>100</b></a>'), '/a', 'b', XMLType('<c>88</c>')) from dual;
 insertchildxmlbefore 
----------------------
 <a>                 +
   <c>88</c>         +
   <b>100</b>        +
 </a>
(1 row)

SELECT insertchildxmlbefore(XMLType('<a><b>100</b><b>200</b></a>'), '/a', 'b', XMLType('<c>88</c>')) from dual;
 insertchildxmlbefore 
----------------------
 <a>                 +
   <c>88</c>         +
   <b>100</b>        +
   <c>88</c>         +
   <b>200</b>        +
 </a>
(1 row)

SELECT insertchildxmlbefore(XMLType('<a><b>100</b><b>200</b></a>'), '/a', 'b[1]', XMLType('<c>88</c>')) from dual;
 insertchildxmlbefore 
----------------------
 <a>                 +
   <c>88</c>         +
   <b>100</b>        +
   <b>200</b>        +
 </a>
(1 row)

SELECT insertchildxmlbefore(XMLType('<a><b>100</b><b>200</b></a>'), '/a', 'b[2]', XMLType('<c>88</c>')) from dual;
 insertchildxmlbefore 
----------------------
 <a>                 +
   <b>100</b>        +
   <c>88</c>         +
   <b>200</b>        +
 </a>
(1 row)

SELECT insertchildxmlbefore(b, '/a', 'b', XMLType('<c>200</c>')) from inaf where a = 2;
 insertchildxmlbefore 
----------------------
 
(1 row)

SELECT insertchildxmlbefore(XMLType('<a><b>100</b><b>200</b></a>'), '/a/b[1]', 'b', XMLType('<c>88</c>')) from dual;
 insertchildxmlbefore 
----------------------
 <a>                 +
   <b>100</b>        +
   <b>200</b>        +
 </a>
(1 row)

SELECT insertchildxmlbefore(data, 'soapenv:Envelope/soapenv:Body/web:BBB','typ:FFF', XMLType('<typ:IVY xmlns:typ="http://www.def.com">Ivory</typ:IVY>'), 'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com"') from xmlnstest where id = 1;
                                                            insertchildxmlbefore                                                            
--------------------------------------------------------------------------------------------------------------------------------------------
 <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com">+
   <soapenv:Body>                                                                                                                          +
     <web:BBB>                                                                                                                             +
       <typ:EEE>41</typ:EEE>                                                                                                               +
       <typ:IVY xmlns:typ="http://www.def.com">Ivory</typ:IVY>                                                                             +
       <typ:FFF>42</typ:FFF>                                                                                                               +
     </web:BBB>                                                                                                                            +
   </soapenv:Body>                                                                                                                         +
 </soapenv:Envelope>
(1 row)

--
-- insertchildxmlafter
--
SELECT insertchildxmlafter(XMLType('<a><b>100</b></a>'), '/a/b', 'b', XMLType('<c>88</c>')) from dual;
 insertchildxmlafter 
---------------------
 <a>                +
   <b>100</b>       +
 </a>
(1 row)

SELECT insertchildxmlafter(XMLType('<a><b>100</b></a>'), '/a', 'b', XMLType('<c>88</c>')) from dual;
 insertchildxmlafter 
---------------------
 <a>                +
   <b>100</b>       +
   <c>88</c>        +
 </a>
(1 row)

SELECT insertchildxmlafter(XMLType('<a><b>100</b><b>200</b></a>'), '/a', 'b', XMLType('<c>88</c>')) from dual;
 insertchildxmlafter 
---------------------
 <a>                +
   <b>100</b>       +
   <c>88</c>        +
   <b>200</b>       +
   <c>88</c>        +
 </a>
(1 row)

SELECT insertchildxmlafter(XMLType('<a><b>100</b><b>200</b></a>'), '/a', 'b[1]', XMLType('<c>88</c>')) from dual;
 insertchildxmlafter 
---------------------
 <a>                +
   <b>100</b>       +
   <c>88</c>        +
   <b>200</b>       +
 </a>
(1 row)

SELECT insertchildxmlafter(XMLType('<a><b>100</b><b>200</b></a>'), '/a', 'b[2]', XMLType('<c>88</c>')) from dual;
 insertchildxmlafter 
---------------------
 <a>                +
   <b>100</b>       +
   <b>200</b>       +
   <c>88</c>        +
 </a>
(1 row)

SELECT insertchildxmlafter(b, '/a', 'b', XMLType('<c>200</c>')) from inaf where a = 2;
 insertchildxmlafter 
---------------------
 
(1 row)

SELECT insertchildxmlafter(XMLType('<a><b>100</b><b>200</b></a>'), '/a/b[1]', 'b', XMLType('<c>88</c>')) from dual;
 insertchildxmlafter 
---------------------
 <a>                +
   <b>100</b>       +
   <b>200</b>       +
 </a>
(1 row)

SELECT insertchildxmlafter(data, 'soapenv:Envelope/soapenv:Body/web:BBB','typ:FFF', XMLType('<typ:IVY xmlns:typ="http://www.def.com">Ivory</typ:IVY>'), 'xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com"') from xmlnstest where id = 1;
                                                            insertchildxmlafter                                                             
--------------------------------------------------------------------------------------------------------------------------------------------
 <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:typ="http://www.def.com" xmlns:web="http://www.abc.com">+
   <soapenv:Body>                                                                                                                          +
     <web:BBB>                                                                                                                             +
       <typ:EEE>41</typ:EEE>                                                                                                               +
       <typ:FFF>42</typ:FFF>                                                                                                               +
       <typ:IVY xmlns:typ="http://www.def.com">Ivory</typ:IVY>                                                                             +
     </web:BBB>                                                                                                                            +
   </soapenv:Body>                                                                                                                         +
 </soapenv:Envelope>
(1 row)

drop table inaf;
drop table xmltest;
drop table xmlnstest;
